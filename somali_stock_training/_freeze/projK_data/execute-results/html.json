{
  "hash": "75254852484c0afea9add60c3af83434",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Somali Fish Stock Training: Landing Data Analysis\"\nformat: html\nexecute: \n  eval: false\n  \n---\n\n\n\n# Fish Landing Data Analysis\n\nThis document presents a comprehensive analysis of fish landing data from Somali coastal regions. The data includes information on landing sites, temporal patterns, fish species composition, and morphometric measurements (length and weight) across different fish groups and regions.\n\n## Setup and Data Loading\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrequire(sf)\nrequire(tidyverse)\nrequire(sizeMat)\nrequire(gt)\nrequire(tidyplots)\nrequire(patchwork)\nrequire(leaflet)\nrequire(plotly)\nrequire(crosstalk)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlw = readxl::read_excel('../data_shared/ProjKalluun_master_data_entry.xlsx', sheet = 'Section 3', skip= 4) |> \n    janitor::clean_names() |> \n    filter(!is.na(landing_site))\n\nlw = lw |> \n mutate(\n    year = year(date_dd_mm_yy),\n    month = month(date_dd_mm_yy, label = TRUE),\n    day = day(date_dd_mm_yy), \n    .after = date_dd_mm_yy\n ) |> \n    mutate(\n    weight_kg = as.numeric(weight_kg),\n    length_cm = as.numeric(length_cm)\n    )\n```\n:::\n\n\n\n## Landing Sites Overview\n\nThis section provides an overview of the landing sites by region.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw |> \n    distinct(landing_site, .keep_all = T) |> \n    filter(!is.na(region)) |> \n    group_by(region) |> \n    summarise(N = n(), ls = paste(landing_site, collapse = ', ')) |> \n    gt() |>\n    tab_header(\n        title = \"Landing Sites by Region\",\n        subtitle = \"Number of sites and listing of sites per region\"\n    ) |>\n    cols_label(\n        region = \"Region\",\n        N = \"Site Count\",\n        ls = \"Landing Sites\"\n    ) |>\n    tab_options(\n        table.width = px(300), \n        table.font.size = '11px', \n        heading.title.font.size = '14px',\n        heading.subtitle.font.size = '12px',\n        heading.subtitle.font.weight = 'bold',\n        latex.use_longtable = TRUE,\n        data_row.padding = px(8),\n        column_labels.padding = px(8)\n    ) |>\n    opt_stylize(style = 6, color = 'gray')\n```\n:::\n\n\n\n## Temporal Patterns\n\n### Monthly Landing Trends by Region\n\nThe following tables show fish landings across months and regions, providing insight into seasonal landing patterns.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw |> \n    group_by(region, month) |> \n    tally() |> \n    ungroup() |> \n    pivot_wider(names_from = c(region), values_from = n, values_fill = 0) |>\n    # Replace 0 with NA in all columns except for year and month\n    mutate(across(-c(month), ~ na_if(., 0))) |>\n    arrange(month) |>\n    gt() |> \n    tab_header(\n        title = \"Fish Landings by Month and Region\",\n        subtitle = \"Monthly landing counts across regions\"\n    ) |>\n    tab_options(\n        table.width = px(500), \n        table.font.size = '11px', \n        heading.title.font.size = '14px',\n        heading.subtitle.font.size = '12px',\n        heading.subtitle.font.weight = 'bold',\n        latex.use_longtable = TRUE,\n        data_row.padding = px(6),\n        column_labels.padding = px(8)\n    ) |>\n    data_color(\n        columns = Berbera:Mogadishu,\n        method = 'quantile',\n        quantiles = 8,\n        colors = scales::col_numeric(\n            palette = 'YlOrRd',\n            domain = NULL\n        )\n    ) |>\n    opt_stylize(style = 6, color = 'gray')\n\nlw |> \n    janitor::tabyl(month, region) |> \n    janitor::adorn_totals(where = c('col',\"row\")) |> \n    as_tibble()  |>\n    gt() |> \n    tab_header(\n        title = \"Fish Landings by Month and Region (Summary)\",\n        subtitle = \"Crosstab with row and column totals\"\n    ) |>\n    tab_options(\n        table.width = px(500), \n        table.font.size = '11px', \n        heading.title.font.size = '14px',\n        heading.subtitle.font.size = '12px',\n        heading.subtitle.font.weight = 'bold',\n        latex.use_longtable = TRUE, \n        data_row.padding = px(6),\n        column_labels.padding = px(8)\n    ) |>\n    data_color(\n        columns = Berbera:Mogadishu,\n        rows = 1:12,\n        method = 'quantile',\n        quantiles = 8,\n        colors = scales::col_numeric(\n            palette = 'YlOrRd',\n            domain = NULL\n        )\n    ) |>\n    opt_stylize(style = 6, color = 'gray')\n```\n:::\n\n\n\n## Seasonal Analysis\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw |> \n    mutate(\n        season = month(date_dd_mm_yy), \n        season = if_else(season > 5 & season < 10, 'SEM', 'NEM')) |> \n    webr::PieDonut(aes(pie = season, donut = region), r0 = .5, labelposition=1)\n```\n:::\n\n\n\n## Fish Group Composition\n\n### Landing Distribution by Fish Group and Region\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw |> \n    janitor::tabyl(fish_group, region) |> \n    janitor::adorn_totals(where = c('col',\"row\")) |> \n    as_tibble()  |>\n    gt() |> \n    tab_header(\n        title = \"Fish Landings by Group and Region\",\n        subtitle = \"Count of specimens landed at each region\"\n    ) |>\n    tab_options(\n        table.width = px(400), \n        table.font.size = '11px', \n        heading.title.font.size = '14px',\n        heading.subtitle.font.size = '12px',\n        heading.subtitle.font.weight = 'bold',\n        latex.use_longtable = TRUE, \n        data_row.padding = px(5),\n        column_labels.padding = px(6)\n    ) |>\n    data_color(\n        columns = Berbera:Mogadishu,\n        rows = 1:8,\n        method = 'quantile',\n        quantiles = 8,\n        colors = scales::col_numeric(\n            palette = 'YlOrRd',\n            domain = NULL\n        )\n    ) |>\n    opt_stylize(style = 6, color = 'gray')\n\n\nlw  |> \n    # janitor::tabyl(region, fish_group )|> \n    webr::PieDonut(aes(pie = fish_group, donut = region), r0 = .5, labelposition = 1) \n```\n:::\n\n\n\n## Landing Trends Over Time\n\n### Absolute and Relative Trends (2017-2023)\n\nThe stacked area charts below illustrate both absolute quantities and relative proportions of fish landings by group from 2017 to 2023.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw |> \n    group_by(year, fish_group) |> \n    tally() |> \n    ungroup() |> \n    tidyplot(x = year, y = n, color = fish_group) |> \n    add_areastack_absolute() |> \n    adjust_colors(new_colors = colors_discrete_friendly_long) |> \n    adjust_size(width = 4.0, height = 2.5, unit = 'in') |> \n    adjust_font(fontsize = 11) |> \n    adjust_y_axis(title = \"Quantity Landed (n)\", breaks = scales::pretty_breaks(n = 6)) |> \n    adjust_x_axis(title = \"Year\", breaks = seq(2017, 2023, by = 1)) |> \n    adjust_title('Fish Landings by Group (Absolute)', fontsize = 13, fontweight = 'bold') |>\n    adjust_legend_title('Fish Group') |> \n    reorder_color_labels(c('Tuna', 'Other', 'Shark', 'Jacks', 'Mackerel', 'Billfish', 'Rays and Skates') |> rev())\n\n\nlw |> \n    group_by(year, fish_group) |> \n    tally() |> \n    ungroup() |> \n    tidyplot(x = year, y = n, color = fish_group) |> \n    add_areastack_relative() |> \n    adjust_colors(new_colors = colors_discrete_friendly_long) |> \n    adjust_size(width = 4.0, height = 2.5, unit = 'in') |> \n    adjust_font(fontsize = 11) |> \n    adjust_y_axis(title = \"Percentage Landed (%)\", labels = scales::percent, breaks = scales::pretty_breaks(n = 6)) |> \n    adjust_x_axis(title = \"Year\", breaks = seq(2017, 2023, by = 1)) |> \n    adjust_title('Fish Landings by Group (Relative)', fontsize = 13, fontweight = 'bold') |>\n    adjust_legend_title('Fish Group') |> \n    reorder_color_labels(c('Tuna', 'Other', 'Shark', 'Jacks', 'Mackerel', 'Billfish', 'Rays and Skates') |> rev())\n```\n:::\n\n\n\n## Morphometric Analysis-Length Distributions\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw |> \n    filter(!fish_group == 'Rays and Skates') |> \n    tidyplot(x = length_cm) |>\n    tidyplots::add_histogram(binwidth = 5, boundary = 0, fill = '#2196F3', alpha = 0.85) |> \n    adjust_size(width = 1.5, height = 1.5, unit = 'in') |> \n    adjust_x_axis(title = 'Length (cm)', limits = c(0, NA), breaks = scales::pretty_breaks(n = 5)) |> \n    adjust_y_axis(title = 'Frequency', breaks = scales::pretty_breaks(n = 5)) |>\n    adjust_title('Length Distribution by Fish Group', fontsize = 12, fontweight = 'bold') |>\n    adjust_font(fontsize = 10) |> \n    split_plot(by = fish_group)\n```\n:::\n\n\n\n\n## Morphometric Analysis-Weight Distributions\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw |> \n    filter(!fish_group == 'Rays and Skates') |> \n    tidyplot(x = weight_kg) |>\n    tidyplots::add_histogram(boundary = 0, fill = '#2196F3', alpha = 0.85) |> \n    adjust_size(width = 1.5, height = 1.5, unit = 'in') |> \n    adjust_x_axis(title = 'Weight (kg)', limits = c(0, NA), breaks = scales::pretty_breaks(n = 5)) |> \n    adjust_y_axis(title = 'Frequency', breaks = scales::pretty_breaks(n = 5)) |>\n    adjust_title('Weight Distribution by Fish Group', fontsize = 12, fontweight = 'bold') |>\n    adjust_font(fontsize = 10) |> \n    split_plot(by = fish_group)\n```\n:::\n\n\n\n### Length-Weight Relationships\n\nThe scatter plot below shows the relationship between fish length and weight by group, with fitted curves indicating allometric growth patterns.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw |> \n    filter(!fish_group == 'Rays and Skates') |> \n    tidyplot(x = length_cm, y = weight_kg) |>\n    add_data_points(alpha = 0.6, size = 2) |> \n    add_curve_fit(method = 'auto', color = '#D32F2F', linewidth = 1.2) |>\n    adjust_size(width = 1.5, height = 1.5, unit = 'in') |> \n    adjust_font(fontsize = 11) |> \n    adjust_x_axis(title = 'Length (cm)', limits = c(0, NA), breaks = scales::pretty_breaks(n = 4)) |> \n    adjust_y_axis(title = 'Weight (kg)', limits = c(0, NA), breaks = scales::pretty_breaks(n = 4)) |>\n    adjust_title('Length-Weight Relationship by Fish Group', fontsize = 13, fontweight = 'bold') |>\n    split_plot(by = fish_group)\n```\n:::\n\n\n\n## Summary Statistics\n\n### Length Distribution by Fish Group and Region\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw |> \n    filter(!fish_group == 'Rays and Skates') |> \n    select(region, length_cm, fish_group) |>\n    group_by(region, fish_group) |>\n    rstatix::get_summary_stats() |> \n    ungroup() |> \n    select(fish_group, region, n, min, q1, median, mean, q3, max, sd) |> \n    arrange(fish_group, region) |>\n    gt(groupname_col = 'fish_group')  |> \n    tab_header(\n        title = \"Length Distribution Summary Statistics by Fish Group and Region\",\n        subtitle = \"Measurements in centimeters, excluding Rays and Skates\"\n    ) |>\n    cols_label(\n        region = \"Region\",\n        n = \"N\",\n        min = \"Min\",\n        q1 = \"Q1\",\n        median = \"Median\",\n        mean = \"Mean\",\n        q3 = \"Q3\",\n        max = \"Max\",\n        sd = \"SD\"\n    ) |>\n    fmt_number(columns = c(min, q1, median, mean, q3, max, sd), decimals = 1) |>\n    tab_options(\n        table.width = px(700), \n        table.font.size = '11px', \n        heading.title.font.size = '14px',\n        heading.subtitle.font.size = '12px', \n        heading.subtitle.font.weight = 'bold',\n        latex.use_longtable = TRUE,\n        data_row.padding = px(5),\n        column_labels.padding = px(6)\n    ) |>\n    data_color(\n        columns = n:sd,\n        rows = everything(),\n        method = 'quantile',\n        quantiles = 8,\n        colors = scales::col_numeric(\n            palette = 'YlOrRd',\n            domain = NULL\n        )\n    ) |>\n    opt_stylize(style = 6, color = 'gray')\n```\n:::\n\n\n\n## Geographic Distribution\n\n### Landing Regions Map\n\nThe interactive map below shows the geographic locations of the landing regions where fish were recorded.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define approximate coordinates for Somali coastal regions\nregion_coords <- tibble(\n    region = c('Berbera', 'Borama', 'Mogadishu', 'Kismayo', 'Baidoa', 'Galkacyo'),\n    latitude = c(10.4145, 9.5283, 2.0469, -0.3604, 3.4314, 6.7719),\n    longitude = c(45.3682, 43.6333, 46.1996, 42.5521, 43.6635, 46.9250),\n    landings = c(NA, NA, NA, NA, NA, NA)\n)\n\n# Get landing counts by region\nlanding_counts <- lw |> \n    filter(!is.na(region)) |> \n    group_by(region) |> \n    tally() |> \n    rename(landings = n)\n\n# Merge coordinates with landing counts\nregion_map_data <- region_coords |> \n    left_join(landing_counts, by = 'region') |> \n    mutate(landings = coalesce(landings.y, landings.x),\n           landings = coalesce(landings, 0)) |> \n    select(region, latitude, longitude, landings)\n\n# Create color palette based on landing counts\npal <- leaflet::colorNumeric(palette = 'YlOrRd', domain = region_map_data$landings)\n\n# Create leaflet map\nleaflet(region_map_data) |> \n    addTiles() |> \n    addCircleMarkers(\n        lng = ~longitude, \n        lat = ~latitude,\n        radius = ~sqrt(landings) / 2,\n        popup = ~paste0('<b>', region, '</b><br/>Landings: ', landings),\n        color = ~pal(landings),\n        fillColor = ~pal(landings),\n        fillOpacity = 0.7,\n        weight = 2,\n        opacity = 0.8\n    ) |> \n    addLegend(\n        pal = pal, \n        values = ~landings,\n        title = 'Number of Landings',\n        position = 'bottomright'\n    ) |>\n    setView(lng = 46, lat = 5, zoom = 6)\n```\n:::\n\n\n\n## Stock Health & Sustainability Indicators\n\n### Catch Per Unit Effort (CPUE) Trends\n\nCPUE is a key indicator of stock abundance. Declining CPUE suggests increasing fishing pressure relative to available stock.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw |> \n    filter(!is.na(region), !is.na(fish_group)) |>\n    group_by(year, region, fish_group, landing_site) |>\n    summarise(catch = n(), .groups = 'drop') |>\n    group_by(year, region, fish_group) |>\n    summarise(\n        total_catch = sum(catch),\n        num_sites = n_distinct(landing_site),\n        cpue = total_catch / num_sites,\n        .groups = 'drop'\n    ) |>\n    tidyplot(x = year, y = cpue, color = fish_group) |>\n    add_data_points(size = 2) |>\n    add_curve_fit(method = 'loess', color = 'gray30', linewidth = 0.8) |>\n    adjust_size(width = 1.5, height = 1.5, unit = 'in') |>\n    adjust_font(fontsize = 11) |>\n    adjust_y_axis(title = 'CPUE (specimens per site)', breaks = scales::pretty_breaks(n = 6)) |>\n    adjust_x_axis(title = 'Year', breaks = seq(2017, 2023, by = 1)) |>\n    adjust_title('Catch Per Unit Effort Trends by Fish Group', fontsize = 13, fontweight = 'bold') |>\n    adjust_legend_title('Fish Group') |>\n    split_plot(by = region)\n```\n:::\n\n\n\n### Average Size Trends (Overfishing Indicator)\n\nDeclining average fish size over time is a strong indicator of overfishing pressure.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw |>\n    filter(!is.na(length_cm), !fish_group == 'Rays and Skates') |>\n    group_by(year, fish_group) |>\n    summarise(\n        mean_length = mean(length_cm, na.rm = TRUE),\n        sd_length = sd(length_cm, na.rm = TRUE),\n        n = n(),\n        .groups = 'drop'\n    ) |>\n    tidyplot(x = year, y = mean_length, color = fish_group) |>\n    add_data_points(size = 2.5) |>\n    add_curve_fit(method = 'loess', linewidth = 1.2) |>\n    adjust_size(width = 4.5, height = 2.8, unit = 'in') |>\n    adjust_font(fontsize = 11) |>\n    adjust_y_axis(title = 'Mean Length (cm)', breaks = scales::pretty_breaks(n = 6)) |>\n    adjust_x_axis(title = 'Year', breaks = seq(2017, 2023, by = 1)) |>\n    adjust_title('Average Fish Size Trends Over Time', fontsize = 13, fontweight = 'bold') |>\n    adjust_legend_title('Fish Group')\n```\n:::\n\n\n\n## Regional Performance & Equity Analysis\n\n### Landing Efficiency by Region\n\nWhich regions are most productive per landing site?\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nregional_efficiency <- lw |>\n    filter(!is.na(region)) |>\n    group_by(region) |>\n    summarise(\n        total_landings = n(),\n        num_sites = n_distinct(landing_site),\n        landings_per_site = total_landings / num_sites,\n        avg_weight_kg = mean(weight_kg, na.rm = TRUE),\n        .groups = 'drop'\n    ) |>\n    arrange(desc(landings_per_site))\n\nregional_efficiency |>\n    gt() |>\n    tab_header(\n        title = \"Regional Landing Efficiency Analysis\",\n        subtitle = \"Productivity metrics by region\"\n    ) |>\n    cols_label(\n        region = \"Region\",\n        total_landings = \"Total Landings\",\n        num_sites = \"Number of Sites\",\n        landings_per_site = \"Landings per Site\",\n        avg_weight_kg = \"Avg Weight (kg)\"\n    ) |>\n    fmt_number(columns = c(landings_per_site, avg_weight_kg), decimals = 2) |>\n    data_color(\n        columns = landings_per_site,\n        method = 'quantile',\n        quantiles = 8,\n        colors = scales::col_numeric(palette = 'RdYlGn', domain = NULL)\n    ) |>\n    tab_options(\n        table.width = px(350),\n        table.font.size = '11px',\n        heading.title.font.size = '14px',\n        heading.subtitle.font.size = '12px',\n        heading.subtitle.font.weight = 'bold',\n        data_row.padding = px(6),\n        column_labels.padding = px(8)\n    ) |>\n    opt_stylize(style = 6, color = 'gray')\n```\n:::\n\n\n\n### Species Diversity by Region (Ecosystem Health)\n\nHigher diversity indicates more balanced and resilient fisheries.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw |>\n    filter(!is.na(region), !is.na(fish_group)) |>\n    group_by(region, fish_group) |>\n    summarise(count = n(), .groups = 'drop') |>\n    group_by(region) |>\n    mutate(\n        total = sum(count),\n        proportion = count / total,\n        diversity_shannon = -sum(proportion * log(proportion), na.rm = TRUE),\n        num_species = n_distinct(fish_group),\n        .groups = 'drop'\n    ) |>\n    distinct(region, diversity_shannon, num_species) |>\n    arrange(desc(diversity_shannon)) |>\n    tidyplot(x = reorder(region, diversity_shannon), y = diversity_shannon) |>\n    add_data_points(fill = '#1976D2', alpha = 0.8) |>\n    adjust_size(width = 3.5, height = 2.5, unit = 'in') |>\n    adjust_font(fontsize = 11) |>\n    adjust_x_axis(title = 'Region') |>\n    adjust_y_axis(title = 'Shannon Diversity Index', breaks = scales::pretty_breaks(n = 5)) |>\n    adjust_title('Species Diversity by Region (Higher = More Resilient)', fontsize = 12, fontweight = 'bold')\n```\n:::\n\n\n\n### Regional Market Share Trends\n\nIdentify which regions contribute most to total catch over time.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw |>\n    filter(!is.na(region)) |>\n    group_by(year, region) |>\n    summarise(landings = n(), .groups = 'drop') |>\n    group_by(year) |>\n    mutate(total = sum(landings), market_share = landings / total * 100) |>\n    tidyplot(x = year, y = market_share, color = region) |>\n    add_areastack_absolute() |>\n    adjust_colors(new_colors = colors_discrete_friendly_long) |>\n    adjust_size(width = 4.5, height = 2.8, unit = 'in') |>\n    adjust_font(fontsize = 11) |>\n    adjust_y_axis(title = 'Market Share (%)', breaks = scales::pretty_breaks(n = 6)) |>\n    adjust_x_axis(title = 'Year', breaks = seq(2017, 2023, by = 1)) |>\n    adjust_title('Regional Market Share Trends', fontsize = 13, fontweight = 'bold') |>\n    adjust_legend_title('Region')\n```\n:::\n\n\n\n## Seasonal Vulnerability Assessment\n\n### Peak Landing Periods vs. Seasonal Patterns\n\nIdentify critical fishing seasons and potential conservation needs.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseasonal_summary <- lw |>\n    filter(!is.na(month)) |>\n    mutate(\n        season = if_else(month(date_dd_mm_yy) > 5 & month(date_dd_mm_yy) < 10, 'SEM', 'NEM')\n    ) |>\n    group_by(month, season) |>\n    summarise(\n        landings = n(),\n        avg_length = mean(length_cm, na.rm = TRUE),\n        avg_weight = mean(weight_kg, na.rm = TRUE),\n        .groups = 'drop'\n    )\n\nseasonal_summary |>\n    tidyplot(x = factor(month, levels = month.abb), y = landings, fill = season) |>\n    add_data_bars(alpha = 0.85) |>\n    adjust_size(width = 5.0, height = 2.8, unit = 'in') |>\n    adjust_font(fontsize = 11) |>\n    adjust_x_axis(title = 'Month') |>\n    adjust_y_axis(title = 'Number of Landings') |>\n    adjust_title('Seasonal Landing Patterns (SEM vs NEM)', fontsize = 13, fontweight = 'bold')\n```\n:::\n\n\n\n### Seasonal Catch Variability (Vulnerability Metric)\n\nHigh variability indicates less stable fisheries.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw |>\n    filter(!is.na(region), !is.na(month)) |>\n    group_by(region, month) |>\n    summarise(landings = n(), .groups = 'drop') |>\n    group_by(region) |>\n    summarise(\n        mean_landings = mean(landings),\n        sd_landings = sd(landings),\n        cv = sd_landings / mean_landings,  # Coefficient of variation\n        .groups = 'drop'\n    ) |>\n    arrange(desc(cv)) |>\n    gt() |>\n    tab_header(\n        title = \"Seasonal Catch Variability by Region\",\n        subtitle = \"Higher CV indicates less stable fisheries\"\n    ) |>\n    cols_label(\n        region = \"Region\",\n        mean_landings = \"Mean Monthly Landings\",\n        sd_landings = \"Std Dev\",\n        cv = \"Coefficient of Variation\"\n    ) |>\n    fmt_number(columns = c(mean_landings, sd_landings, cv), decimals = 2) |>\n    data_color(\n        columns = cv,\n        method = 'quantile',\n        quantiles = 8,\n        colors = scales::col_numeric(palette = 'RdYlGn_r', domain = NULL)\n    ) |>\n    tab_options(\n        table.width = px(700),\n        table.font.size = '11px',\n        heading.title.font.size = '14px',\n        heading.subtitle.font.size = '12px',\n        heading.subtitle.font.weight = 'bold',\n        data_row.padding = px(6),\n        column_labels.padding = px(8)\n    ) |>\n    opt_stylize(style = 6, color = 'gray')\n```\n:::\n\n\n\n## Species-Specific Risk Assessment\n\n### Dominance Analysis (Ecosystem Concentration Risk)\n\nOver-reliance on few species increases vulnerability to stock collapse.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw |>\n    filter(!is.na(fish_group)) |>\n    group_by(fish_group) |>\n    summarise(count = n(), .groups = 'drop') |>\n    mutate(\n        total = sum(count),\n        proportion = count / total,\n        percentage = proportion * 100\n    ) |>\n    arrange(desc(percentage)) |>\n    tidyplot(x = reorder(fish_group, percentage), y = percentage) |>\n    add_data_bars(fill = '#FF6F00', alpha = 0.85) |>\n    adjust_size(width = 4.0, height = 2.8, unit = 'in') |>\n    adjust_font(fontsize = 11) |>\n    adjust_x_axis(title = 'Fish Group') |>\n    adjust_y_axis(title = 'Percentage of Total Landings (%)', breaks = scales::pretty_breaks(n = 5)) |>\n    adjust_title('Catch Dominance: Ecosystem Concentration Risk', fontsize = 12, fontweight = 'bold')\n```\n:::\n\n\n\n### Growth Rate Estimates from Allometric Relationships\n\nSteeper slopes indicate faster growth; deviations may signal stress.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngrowth_analysis <- lw |>\n    filter(!is.na(length_cm), !is.na(weight_kg), !fish_group == 'Rays and Skates') |>\n    group_by(fish_group) |>\n    summarise(\n        n_obs = n(),\n        r_squared = cor(log(length_cm), log(weight_kg), use = 'complete.obs')^2,\n        min_length = min(length_cm, na.rm = TRUE),\n        max_length = max(length_cm, na.rm = TRUE),\n        mean_weight = mean(weight_kg, na.rm = TRUE),\n        .groups = 'drop'\n    )\n\ngrowth_analysis |>\n    gt() |>\n    tab_header(\n        title = \"Growth Pattern Analysis by Fish Group\",\n        subtitle = \"Length-weight relationships indicate population health\"\n    ) |>\n    cols_label(\n        fish_group = \"Fish Group\",\n        n_obs = \"Observations\",\n        r_squared = \"RÂ² (Fit Quality)\",\n        min_length = \"Min Length (cm)\",\n        max_length = \"Max Length (cm)\",\n        mean_weight = \"Mean Weight (kg)\"\n    ) |>\n    fmt_number(columns = c(r_squared, mean_weight), decimals = 3) |>\n    tab_options(\n        table.width = px(450),\n        table.font.size = '11px',\n        heading.title.font.size = '14px',\n        heading.subtitle.font.size = '12px',\n        heading.subtitle.font.weight = 'bold',\n        data_row.padding = px(6),\n        column_labels.padding = px(8)\n    ) |>\n    opt_stylize(style = 6, color = 'gray')\n```\n:::\n\n\n\n## Effort Dynamics & Spatial Concentration\n\n### Landing Site Productivity Trends\n\nIdentify if fishing activity is centralizing or dispersing.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw |>\n    filter(!is.na(landing_site), !is.na(region)) |>\n    group_by(year, region, landing_site) |>\n    summarise(landings = n(), .groups = 'drop') |>\n    group_by(year, region) |>\n    summarise(\n        total_landings = sum(landings),\n        num_active_sites = n_distinct(landing_site),\n        avg_site_productivity = total_landings / num_active_sites,\n        .groups = 'drop'\n    ) |>\n    tidyplot(x = year, y = num_active_sites, color = region) |>\n    add_data_points(size = 2.5) |>\n    add_curve_fit(method = 'loess', linewidth = 1) |>\n    adjust_size(width = 4.5, height = 2.8, unit = 'in') |>\n    adjust_font(fontsize = 11) |>\n    adjust_y_axis(title = 'Number of Active Landing Sites') |>\n    adjust_x_axis(title = 'Year', breaks = seq(2017, 2023, by = 1)) |>\n    adjust_title('Landing Site Activity Trends', fontsize = 13, fontweight = 'bold') |>\n    adjust_legend_title('Region')\n```\n:::\n\n\n\n## Catch Composition Shifts (Early Warning System)\n\n### Year-over-Year Composition Changes\n\nDetect ecosystem shifts and unusual species patterns.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncomposition_shifts <- lw |>\n    filter(!is.na(fish_group), !is.na(year)) |>\n    group_by(year, fish_group) |>\n    summarise(count = n(), .groups = 'drop') |>\n    group_by(year) |>\n    mutate(\n        total = sum(count),\n        proportion = count / total * 100\n    ) |>\n    pivot_wider(names_from = fish_group, values_from = proportion, values_fill = 0)\n\ncomposition_shifts |>\n    gt() |>\n    tab_header(\n        title = \"Catch Composition Changes Over Time\",\n        subtitle = \"Year-over-year shifts in species proportions (%)\"\n    ) |>\n    fmt_number(columns = -year, decimals = 1) |>\n    data_color(\n        columns = -year,\n        method = 'quantile',\n        quantiles = 8,\n        colors = scales::col_numeric(palette = 'YlOrRd', domain = NULL)\n    ) |>\n    tab_options(\n        table.width = px(500),\n        table.font.size = '10px',\n        heading.title.font.size = '14px',\n        heading.subtitle.font.size = '12px',\n        heading.subtitle.font.weight = 'bold',\n        data_row.padding = px(5),\n        column_labels.padding = px(6)\n    ) |>\n    opt_stylize(style = 6, color = 'gray')\n```\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}