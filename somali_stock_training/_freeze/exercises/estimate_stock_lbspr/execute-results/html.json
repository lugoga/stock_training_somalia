{
  "hash": "863578037fc107242a612363fe5afa59",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Stock Assessment Using LBSPR\"\nsubtitle: \"Selected species of tuna and tuna-like fish in Somalia Water\"\nauthor: \"Rushingisha George, Masumbuko Semba, and Mathew Silas\"\nformat: html\ndate: \"2025-12-16\"\ndate-modified: today\ntoc: true\nlot: true\nlof: true\nembed-resources: true\nexecute: \n  echo: true\n  error: false\n  comment: \"\"\n  warning: false\n  message: false\ncode-fold: show\n---\n\n\n\n\n## Introduction\n\nThis document provides a step-by-step guide to performing a stock assessment simulation using the **Length-Based Spawning Potential Ratio (LBSPR)** method. LBSPR is a powerful technique for assessing the health of fish stocks, especially in data-limited situations where traditional age-based data is unavailable.\n\nWe will first simulate a fish population with known biological and fishery characteristics to understand how the LBSPR model works. This simulation will generate an expected length-frequency distribution, which can later be compared against real-world data collected from fisheries.\n\n## Setting Up the R Environment\n\n**What we're doing:** Load the R packages needed for the entire analysis. Each package provides specialized functions for different parts of the stock assessment.\n\n**Package purposes:**\n- **tidyverse**: Data manipulation, filtering, and reshaping\n- **tidyplots**: Easy, publication-quality plotting\n- **LBSPR**: Length-based spawning potential ratio analysis\n- **sizeMat**: Estimating size at sexual maturity\n- **gt**: Creating professional tables\n- **TropFishR**: Tropical fisheries stock assessment methods\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required libraries\nrequire(tidyverse)\nrequire(tidyplots)\nrequire(LBSPR)\nrequire(sizeMat)\nrequire(gt) \nrequire(TropFishR)\n```\n:::\n\n\n\n\n# Approach\n\n## Data\n\n**What we're doing:** Read the fisheries dataset containing length, weight, species, and catch information from a CSV file.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlw = read_csv(\"lw2.csv\")\n```\n:::\n\n\n\n\n### Model Fish Group: Yellowfin Tuna\n\n**What we're doing:** Filter the dataset to focus on Yellowfin Tuna (YFT) for this demonstration.\n\n**Why it matters:** Working with a single species ensures we're analyzing fish with similar biology and behavior.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyft = lw |> \n    filter(fish_type_code == 'YFT')\n```\n:::\n\n\n\n\n### Explore Length-Weight Relationship\n\n**What we're doing:** Create a scatter plot showing how length and weight relate for Yellowfin Tuna across regions, excluding Berbera and very small fish.\n\n**What to look for:** \n- A smooth curved relationship indicates normal growth\n- Outliers might indicate data quality issues\n- The curve should follow the power-law relationship: Weight ∝ Length³\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyft |> \n  filter(!region %in% c('Berbera') & length_cm > 20) |> \n  tidyplot(x = length_cm, y = weight_kg, color = region) |> \n  add_data_points() |> \n  add_curve_fit() |> \n  adjust_size(width = 2, height = 3, unit = 'in') |> \n  adjust_font(fontsize = 12) |> \n  adjust_legend_position(position = c(.35, .9)) |> \n  adjust_x_axis(title = 'Length (cm)') |> \n  adjust_y_axis(title = 'Weight (kg)') |> \n  remove_legend_title()\n```\n\n::: {.cell-output-display}\n![](estimate_stock_lbspr_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n### Data Quality Filter\n\n**What we're doing:** Remove problematic data by excluding Berbera region and small fish under 20 cm.\n\n**Why it matters:** Clean data improves assessment reliability and removes potential juveniles with different growth patterns.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyft = lw |> \n    filter(fish_type_code == 'YFT' & !region == 'Berbera' & length_cm > 20)\n```\n:::\n\n\n\n\n### Maturity Classification\n\n**What we're doing:** Separate fish into two groups—mature and immature—based on their length-weight relationships using linear discriminant analysis.\n\n**Why it matters:** Maturity status is critical for LBSPR because it determines the L50 and L95 parameters that define when fish can reproduce.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Partitioning with Frequentist regression \nclassified_yft <- yft |> \n  classify_mature(\n    varNames = c(\"length_cm\", \"weight_kg\"),\n    varSex = NULL, \n    selectSex = NULL,\n    method = \"ld\"\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nall individuals were used in the analysis \n```\n\n\n:::\n\n```{.r .cell-code}\nclassified_yft\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNumber in juvenile group = 272 \n\nNumber in adult group = 98 \n\n-------------------------------------------------------- \n1) Linear regression for juveniles \n\nCall:\nglm(formula = y ~ x, data = juv)\n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept) -9.184692   0.513034  -17.90   <2e-16 ***\nx            0.220284   0.007291   30.21   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for gaussian family taken to be 1.638605)\n\n    Null deviance: 1938.03  on 271  degrees of freedom\nResidual deviance:  442.42  on 270  degrees of freedom\nAIC: 910.22\n\nNumber of Fisher Scoring iterations: 2\n\n-------------------------------------------------------- \n2) Linear regression for adults \n\nCall:\nglm(formula = y ~ x, data = adt)\n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) -69.6649     5.7059  -12.21   <2e-16 ***\nx             0.8608     0.0478   18.01   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for gaussian family taken to be 106.3829)\n\n    Null deviance: 44716  on 97  degrees of freedom\nResidual deviance: 10213  on 96  degrees of freedom\nAIC: 739.46\n\nNumber of Fisher Scoring iterations: 2\n\n-------------------------------------------------------- \n3) Difference between slopes (ANCOVA) \n               Estimate Std. Error    t value     Pr(>|t|)\n(Intercept)  -9.1846920 2.16246354  -4.247328 2.746951e-05\nx             0.2202842 0.03073368   7.167517 4.244089e-12\nmature      -60.4802433 3.68591106 -16.408492 9.644949e-46\nx:mature      0.6405282 0.03962059  16.166549 9.554434e-45\n[1] \"slopes are different\"\n```\n\n\n:::\n:::\n\n\n\n\n### Visualize Maturity Classification\n\n**What we're doing:** Plot the classified mature and immature fish to visually inspect the separation quality.\n\n**What to look for:** Clear separation between mature (upper right) and immature (lower left) groups indicates good classification accuracy.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclassified_yft |> \n  plot(\n    xlab = 'Length (cm)', \n    ylab = 'Weight (kg)',\n    cex.main = 1.5,\n    cex.lab = 1.2,\n    cex.axis = 1\n  )\n```\n\n::: {.cell-output-display}\n![](estimate_stock_lbspr_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n### L50 Estimation\n\n**What we're doing:** Estimate the logistic maturity curve using 1000 bootstrap samples to calculate:\n- **L50:** Length at which 50% of fish are mature\n- **L95:** Length at which 95% of fish are mature\n\n**Why it matters:** L50 and L95 are key biological parameters for LBSPR that define the spawning population.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyft_ogive_fq <- classified_yft |> \n  morph_mature(\n    method = \"fq\", \n    niter = 1000\n)\n```\n:::\n\n\n\n\n### Display Maturity Curve Parameters\n\n**What we're doing:** Create a professional table showing the estimated maturity curve parameters.\n\n**Table columns:**\n- **A & B:** Logistic curve coefficients (intercept and slope)\n- **L50:** Length (cm) where 50% are mature\n- **R²:** Goodness of fit (closer to 1.0 is better)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyft_ogive_fq |> \n    print() |> \n    as.data.frame() |> \n    as_tibble() |> \n    mutate(Freq = as.numeric(Freq)) |> \n    pivot_wider(names_from = Var1 , values_from  = Freq) |> \n    gt() |> \n    fmt_number(columns = everything(), decimals = 2) |> \n    fmt_missing(columns = everything(), missing_text = '-') |> \n    cols_label(\n        Var2 ~ 'Variables',\n        L50 ~ md('L~50~'),\n        R2  ~ md('R^2^')\n    ) |>\n    tab_spanner(columns = c('A', 'B'), label = 'Ogive Parameters') |> \n    tab_options(data_row.padding = px(5), table.font.size = '12pt') |> \n    cols_width(\n        Var2 ~ px(200),\n        A ~ px(120),\n        B ~ px(70),\n        L50 ~ px(70),\n        R2 ~ px(70)\n    ) |> \n    tab_footnote(footnote = 'A for Intercept of the logistic curve.', locations = cells_column_labels(columns = 'A'))|> \n    tab_footnote(footnote = 'B for slope of the logistic curve.', locations = cells_column_labels(columns = 'B'))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nformula: Y = 1/1+exp-(A + B*X) \n```\n\n\n:::\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"oajhaqwzyg\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#oajhaqwzyg table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#oajhaqwzyg thead, #oajhaqwzyg tbody, #oajhaqwzyg tfoot, #oajhaqwzyg tr, #oajhaqwzyg td, #oajhaqwzyg th {\n  border-style: none;\n}\n\n#oajhaqwzyg p {\n  margin: 0;\n  padding: 0;\n}\n\n#oajhaqwzyg .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 12pt;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#oajhaqwzyg .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#oajhaqwzyg .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#oajhaqwzyg .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#oajhaqwzyg .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#oajhaqwzyg .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#oajhaqwzyg .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#oajhaqwzyg .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#oajhaqwzyg .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#oajhaqwzyg .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#oajhaqwzyg .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#oajhaqwzyg .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#oajhaqwzyg .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#oajhaqwzyg .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#oajhaqwzyg .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#oajhaqwzyg .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#oajhaqwzyg .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#oajhaqwzyg .gt_row {\n  padding-top: 5px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#oajhaqwzyg .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#oajhaqwzyg .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#oajhaqwzyg .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#oajhaqwzyg .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#oajhaqwzyg .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#oajhaqwzyg .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#oajhaqwzyg .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#oajhaqwzyg .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#oajhaqwzyg .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#oajhaqwzyg .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#oajhaqwzyg .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#oajhaqwzyg .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#oajhaqwzyg .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#oajhaqwzyg .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#oajhaqwzyg .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#oajhaqwzyg .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#oajhaqwzyg .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#oajhaqwzyg .gt_left {\n  text-align: left;\n}\n\n#oajhaqwzyg .gt_center {\n  text-align: center;\n}\n\n#oajhaqwzyg .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#oajhaqwzyg .gt_font_normal {\n  font-weight: normal;\n}\n\n#oajhaqwzyg .gt_font_bold {\n  font-weight: bold;\n}\n\n#oajhaqwzyg .gt_font_italic {\n  font-style: italic;\n}\n\n#oajhaqwzyg .gt_super {\n  font-size: 65%;\n}\n\n#oajhaqwzyg .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#oajhaqwzyg .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#oajhaqwzyg .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#oajhaqwzyg .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#oajhaqwzyg .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#oajhaqwzyg .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#oajhaqwzyg .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#oajhaqwzyg .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#oajhaqwzyg div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" style=\"table-layout:fixed;width:0px;\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <colgroup>\n    <col style=\"width:200px;\"/>\n    <col style=\"width:120px;\"/>\n    <col style=\"width:70px;\"/>\n    <col style=\"width:70px;\"/>\n    <col style=\"width:70px;\"/>\n  </colgroup>\n  <thead>\n    <tr class=\"gt_col_headings gt_spanner_row\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"Var2\">Variables</th>\n      <th class=\"gt_center gt_columns_top_border gt_column_spanner_outer\" rowspan=\"1\" colspan=\"2\" scope=\"colgroup\" id=\"Ogive Parameters\">\n        <div class=\"gt_column_spanner\">Ogive Parameters</div>\n      </th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"L50\"><span data-qmd-base64=\"TH41MH4=\"><span class='gt_from_md'>L<sub>50</sub></span></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"2\" colspan=\"1\" scope=\"col\" id=\"R2\"><span data-qmd-base64=\"Ul4yXg==\"><span class='gt_from_md'>R<sup>2</sup></span></span></th>\n    </tr>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"A\">A<span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>1</sup></span></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"B\">B<span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>2</sup></span></th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Var2\" class=\"gt_row gt_center\">Original</td>\n<td headers=\"A\" class=\"gt_row gt_right\">−43.36</td>\n<td headers=\"B\" class=\"gt_row gt_right\">0.47</td>\n<td headers=\"L50\" class=\"gt_row gt_right\">91.53</td>\n<td headers=\"R2\" class=\"gt_row gt_right\">0.94</td></tr>\n    <tr><td headers=\"Var2\" class=\"gt_row gt_center\">Bootstrap (Median)</td>\n<td headers=\"A\" class=\"gt_row gt_right\">−44.88</td>\n<td headers=\"B\" class=\"gt_row gt_right\">0.49</td>\n<td headers=\"L50\" class=\"gt_row gt_right\">91.51</td>\n<td headers=\"R2\" class=\"gt_row gt_right\">-</td></tr>\n  </tbody>\n  <tfoot>\n    <tr class=\"gt_footnotes\">\n      <td class=\"gt_footnote\" colspan=\"5\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>1</sup></span> A for Intercept of the logistic curve.</td>\n    </tr>\n    <tr class=\"gt_footnotes\">\n      <td class=\"gt_footnote\" colspan=\"5\"><span class=\"gt_footnote_marks\" style=\"white-space:nowrap;font-style:italic;font-weight:normal;line-height:0;\"><sup>2</sup></span> B for slope of the logistic curve.</td>\n    </tr>\n  </tfoot>\n</table>\n</div>\n```\n\n:::\n:::\n\n\n\n\n### Plot Maturity Ogive\n\n**What we're doing:** Visualize the maturity curve showing the proportion of mature fish at each length.\n\n**What it shows:** An S-shaped (logistic) curve where:\n- Below L50: mostly immature fish\n- Above L50: mostly mature fish\n- The steepness shows how quickly maturity is reached\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nyft_ogive_fq |> \n    plot(\n    main = 'Maturity Ogive of Yellowfin Tuna',\n    xlab = 'Length (cm)', \n    ylab = 'Proportion Mature',\n    cex.main = 1.5,\n    cex.lab = 1.2,\n    cex.axis = 1, \n    onlyOgive = TRUE\n)\n```\n\n::: {.cell-output-display}\n![](estimate_stock_lbspr_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSize at morphometric maturity = 91.5 \nConfidence intervals = 89.8 - 93.4 \nRsquare = 0.94\n```\n\n\n:::\n:::\n\n\n\n\n### Prepare Length-Frequency Data\n\n**What we're doing:** Convert individual fish measurements into binned length-frequency data with smoothing applied.\n\n**Process:**\n1. Create length-frequency bins\n2. Aggregate data by month\n3. Apply moving average (MA = 9) to smooth seasonal variation\n4. Apply square root transformation to stabilize variance\n\n**Why it matters:** LBSPR requires data in length-class format; smoothing reduces sampling noise.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\naa = yft |> \n   mutate(\n    date = lubridate::make_date(year = 2024, month = month(date_dd_mm_yy), day = 15)\n    )\n\naa |> \n  TropFishR::lfqCreate(\n    Lname = \"length_cm\", \n    Dname = \"date\", \n    bin_size = 2, \n    species = \"Yellowfin\", \n    length_unit = \"cm\", \n    aggregate_dates = TRUE\n    ) |> \n  TropFishR::lfqModify(\n    bin_size = 4, \n    aggregate = \"month\", \n    vectorise_catch = FALSE\n    ) |> \n  TropFishR::lfqRestructure(\n    MA = 9, \n    addl.sqrt = TRUE\n    ) |> \n    plot(        \n        Fname = \"catch\", \n        las = 1,\n        ylab = 'Length classes (cm)',\n        cex.main = 1.5,\n        cex.lab = 1.2,\n        cex.axis = 1\n    )\n```\n\n::: {.cell-output-display}\n![](estimate_stock_lbspr_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n\n\n## LBSPR Model\n\n### Create a New LB_pars Object\n\n**What we're doing:** Create an empty LB_pars object—a special R data structure designed to hold LBSPR model parameters.\n\n**Why it matters:** This object organizes all biological and fishery parameters in a standardized format.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nMyPars <- new(\"LB_pars\")\n```\n:::\n\n\n\n\n### Examine LB_pars Slots\n\n**What we're doing:** Display all 25 slots (parameter slots) available in the LB_pars object.\n\n**Note:** You don't need to fill all slots—many have default values. Only minimum parameters are required (see next section).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nMyPars |> slotNames()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Species\"      \"MK\"           \"M\"            \"Linf\"         \"L_units\"     \n [6] \"CVLinf\"       \"L50\"          \"L95\"          \"Walpha\"       \"Walpha_units\"\n[11] \"Wbeta\"        \"FecB\"         \"Steepness\"    \"Mpow\"         \"R0\"          \n[16] \"SL50\"         \"SL95\"         \"MLL\"          \"sdLegal\"      \"fDisc\"       \n[21] \"FM\"           \"SPR\"          \"BinMin\"       \"BinMax\"       \"BinWidth\"    \n```\n\n\n:::\n:::\n\n\n\n\n### Populate the LB_pars Object\n\n**What we're doing:** Fill the LB_pars object with biological and exploitation parameters needed for the LBSPR simulation.\n\n**Minimum required parameters:**\n\n**Biology:**\n- **Linf:** Von Bertalanffy asymptotic length (maximum theoretical length)\n- **L50 & L95:** Lengths at 50% and 95% maturity\n- **M/K:** Natural mortality divided by growth coefficient (describes life history strategy)\n\n**Exploitation:**\n- **SL50 & SL95:** Lengths at 50% and 95% selectivity by fishing gear\n- **SPR or F/M:** Either specify Spawning Potential Ratio or Fishing/Natural mortality ratio\n\n**Size classes:**\n- **BinWidth:** Length interval for size classes (typically 5 cm)\n\n**Example parameters:** These are hypothetical values for demonstration. In a real analysis, these would come from your data analysis (like we did above with Yellowfin).\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## Biological parameters\nMyPars@Species = 'Yellowfin'\nMyPars@Linf <- 100  # Maximum length (cm)\nMyPars@L50 <- 66    # Length at 50% maturity (cm)\nMyPars@L95 <- 70    # Length at 95% maturity (cm)\nMyPars@MK <- 1.5    # M/K ratio (natural mortality / growth rate)\n\n## Exploitation parameters\nMyPars@SL50 <- 50   # Length at 50% selectivity (cm)\nMyPars@SL95 <- 65   # Length at 95% selectivity (cm)\nMyPars@SPR <- 0.4   # Target spawning potential ratio (40% of unfished)\nMyPars@BinWidth <- 5\n\n## Size class boundaries\nMyPars@BinMax <- 150\nMyPars@BinMin <- 0\nMyPars@L_units <- \"mm\"\n```\n:::\n\n\n\n\n### View the Populated Parameters\n\n**What we're doing:** Display the LB_pars object to verify all parameters are correctly entered.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nMyPars\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAn object of class \"LB_pars\"\nSlot \"Species\":\n[1] \"Yellowfin\"\n\nSlot \"MK\":\n[1] 1.5\n\nSlot \"M\":\nnumeric(0)\n\nSlot \"Linf\":\n[1] 100\n\nSlot \"L_units\":\n[1] \"mm\"\n\nSlot \"CVLinf\":\n[1] 0.1\n\nSlot \"L50\":\n[1] 66\n\nSlot \"L95\":\n[1] 70\n\nSlot \"Walpha\":\n[1] 1e-04\n\nSlot \"Walpha_units\":\ncharacter(0)\n\nSlot \"Wbeta\":\n[1] 3\n\nSlot \"FecB\":\n[1] 3\n\nSlot \"Steepness\":\n[1] 0.7\n\nSlot \"Mpow\":\n[1] 0\n\nSlot \"R0\":\n[1] 10000\n\nSlot \"SL50\":\n[1] 50\n\nSlot \"SL95\":\n[1] 65\n\nSlot \"MLL\":\nnumeric(0)\n\nSlot \"sdLegal\":\nnumeric(0)\n\nSlot \"fDisc\":\nnumeric(0)\n\nSlot \"FM\":\nnumeric(0)\n\nSlot \"SPR\":\n[1] 0.4\n\nSlot \"BinMin\":\n[1] 0\n\nSlot \"BinMax\":\n[1] 150\n\nSlot \"BinWidth\":\n[1] 5\n```\n\n\n:::\n:::\n\n\n\n\n### Run the LBSPR Simulation\n\n**What we're doing:** Execute the LBSPR model to simulate what a fish population would look like with these specific biological and exploitation parameters.\n\n**Output:** An LB_obj object containing simulated population dynamics, size structure, and stock status metrics.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nMySim = MyPars |> \n  LBSPRsim()\n```\n:::\n\n\n\n\n### Visualize Full LBSPR Results\n\n**What we're doing:** Create four diagnostic plots showing:\n- **Top-left:** Expected catch size structure vs. unfished population\n- **Top-right:** Maturity and selectivity curves overlaid\n- **Bottom-left:** Von Bertalanffy growth curve\n- **Bottom-right:** SPR and yield curves (stock status relative to reference points)\n\n**Interpretation:** \n- Yellow lines show expected patterns\n- Red lines show what we observe in the catch\n- SPR plot shows if stock is overfished (low SPR) or healthy (high SPR)\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nMySim |> \n  plotSim()\n```\n\n::: {.cell-output-display}\n![](estimate_stock_lbspr_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n\n### Plot Length-Frequency Results\n\n**What we're doing:** Visualize just the expected size structure (length-frequency distribution) from the simulation.\n\n**What to look for:** \n- The modal length (peak) indicates what size fish dominate the catch\n- A gap between modal length and maximum length suggests high fishing mortality\n- Multiple modes may indicate strong recruitment pulses\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nMySim |> \n  plotSim(type = \"len.freq\")\n```\n\n::: {.cell-output-display}\n![](estimate_stock_lbspr_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n\n\n### Plot Population Structure\n\n**What we're doing:** Compare the expected catch composition with the unfished (spawning stock) population structure.\n\n**What it shows:**\n- Blue line: Unfished population (what it would look like with no fishing)\n- Red line: Current catch composition (effect of fishing and selectivity)\n- The difference illustrates fishing impact on population structure\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nMySim |>  \n  plotSim(lf.type = \"pop\")\n```\n\n::: {.cell-output-display}\n![](estimate_stock_lbspr_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "estimate_stock_lbspr_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}